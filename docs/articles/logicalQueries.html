<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logical queries in interactive graphics • loon</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logical queries in interactive graphics">
<meta property="og:description" content="loon">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">loon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/introduction.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/savingLoonPlots.html">Saving loon plots</a>
    </li>
    <li>
      <a href="../articles/logicalQueries.html">Logical queries in interactive graphics</a>
    </li>
    <li>
      <a href="../articles/minorities.html">Analysis example</a>
    </li>
    <li>
      <a href="../articles/teaching-example-smoothing.html">Teaching example</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Videos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://youtu.be/JFJcg855HcQ">the (not so) humble (interactive) histogram</a>
    </li>
    <li>
      <a href="https://youtu.be/mMJllGOuDLY">3D interactive scatterplots</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/great-northern-diver/loon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Logical queries in interactive graphics</h1>
                        <h4 class="author">R.W. Oldford</h4>
            
            <h4 class="date">2021-03-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/great-northern-diver/loon/blob/master/vignettes/logicalQueries.Rmd"><code>vignettes/logicalQueries.Rmd</code></a></small>
      <div class="hidden name"><code>logicalQueries.Rmd</code></div>

    </div>

    
    
<p>One of the principal strengths of linked plots is the ease with which one can form complex logical queries on the data.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">loon</span>)</pre></body></html></div>
<div id="the-cars-of-the-1974-motor-trends-magazine" class="section level2">
<h2 class="hasAnchor">
<a href="#the-cars-of-the-1974-motor-trends-magazine" class="anchor"></a>The cars of the 1974 Motor Trends magazine</h2>
<p>Begin with a classic data set in <code>R</code> – <code>mtcars</code>.<br>
For the sake of illustration, some enrichment of the variables and their values will be made:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">mtcars</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"datasets"</span>)

<span class="no">mtcars</span>$<span class="no">country</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Japan"</span>, <span class="st">"Japan"</span>, <span class="st">"Japan"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>,
                    <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>,
                    <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"Italy"</span>,
                    <span class="st">"Japan"</span>, <span class="st">"Japan"</span>, <span class="st">"Japan"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"USA"</span>,
                    <span class="st">"Italy"</span>, <span class="st">"Germany"</span>, <span class="st">"UK"</span>, <span class="st">"USA"</span>, <span class="st">"Italy"</span>, <span class="st">"italy"</span>, <span class="st">"Sweden"</span>)
<span class="no">mtcars</span>$<span class="no">continent</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Asia"</span>, <span class="st">"Asia"</span>, <span class="st">"Asia"</span>, <span class="st">"North America"</span>, <span class="st">"North America"</span>,
                      <span class="st">"North America"</span>, <span class="st">"North America"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span>,
                      <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span>,
                      <span class="st">"North America"</span>, <span class="st">"North America"</span>, <span class="st">"North America"</span>,
                      <span class="st">"Europe"</span>, <span class="st">"Asia"</span>, <span class="st">"Asia"</span>, <span class="st">"Asia"</span>, <span class="st">"North America"</span>,
                      <span class="st">"North America"</span>, <span class="st">"North America"</span>, <span class="st">"North America"</span>,
                      <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"North America"</span>,
                      <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span> )
<span class="no">mtcars</span>$<span class="no">company</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Mazda"</span>, <span class="st">"Mazda"</span>, <span class="st">"Nissan"</span>, <span class="st">"AMC"</span>, <span class="st">"AMC"</span>, <span class="st">"Chrysler"</span>,
                    <span class="st">"Chrysler"</span>, <span class="st">"Mercedes"</span>, <span class="st">"Mercedes"</span>, <span class="st">"Mercedes"</span>, <span class="st">"Mercedes"</span>,
                    <span class="st">"Mercedes"</span>, <span class="st">"Mercedes"</span>, <span class="st">"Mercedes"</span>, <span class="st">"GM"</span>, <span class="st">"Ford"</span>,
                    <span class="st">"Chrysler"</span>, <span class="st">"Fiat"</span>, <span class="st">"Honda"</span>, <span class="st">"Toyota"</span>, <span class="st">"Toyota"</span>, <span class="st">"Chrysler"</span>,
                    <span class="st">"AMC"</span>, <span class="st">"GM"</span>, <span class="st">"GM"</span>, <span class="st">"Fiat"</span>, <span class="st">"Porsche"</span>, <span class="st">"Lotus"</span>, <span class="st">"Ford"</span>,
                    <span class="st">"Ferrari"</span>, <span class="st">"Maserati"</span>, <span class="st">"Volvo"</span>)

<span class="no">mtcars</span>$<span class="no">Engine</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V-shaped"</span>, <span class="st">"Straight"</span>)[<span class="no">mtcars</span>$<span class="no">vs</span> +<span class="fl">1</span>],
                        <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"V-shaped"</span>, <span class="st">"Straight"</span>))
<span class="no">mtcars</span>$<span class="no">Transmission</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"automatic"</span>, <span class="st">"manual"</span>)[<span class="no">mtcars</span>$<span class="no">am</span> +<span class="fl">1</span>],
                              <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"automatic"</span>, <span class="st">"manual"</span>))

<span class="no">mtcars</span>$<span class="no">vs</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>  <span class="co"># These are redundant now</span>
<span class="no">mtcars</span>$<span class="no">am</span> <span class="kw">&lt;-</span> <span class="kw">NULL</span>  <span class="co"># </span></pre></body></html></div>
<p>For this illustration, it will be convenient to separate categorical from continuous data.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">varTypes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">mtcars</span>),
                  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">mtcars</span>,
                         <span class="kw">FUN</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>){
                             <span class="kw">if</span>(<span class="fu"><a href="https://rdrr.io/r/base/factor.html">is.factor</a></span>(<span class="no">x</span>)<span class="kw">|</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">is.character</a></span>(<span class="no">x</span>)){
                                 <span class="st">"categorical"</span>
                                  } <span class="kw">else</span> {<span class="st">"numeric"</span>} } ))</pre></body></html></div>
<p><code>varTypes</code> is a list with two named components: <code>categorical</code> and <code>numeric</code>.</p>
</div>
<div id="some-interactive-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#some-interactive-plots" class="anchor"></a>Some interactive plots</h2>
<p>To explore the data, several interactive plots will likely have been constructed. Typically, these will have been constructed one at a time and assigned to the same linking group (perhaps via the inspector). Below, histograms/barplots are constructed for each categorical variable and assigned to that variable name now prefixed by <code>h_</code> for “histogram”.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw">for</span> (<span class="no">varName</span> <span class="kw">in</span> <span class="no">varTypes</span>$<span class="no">categorical</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"h_"</span>, <span class="no">varName</span>),
           <span class="fu"><a href="../reference/l_hist.html">l_hist</a></span>(<span class="no">mtcars</span>[ , <span class="no">varName</span>], <span class="kw">showFactors</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                  <span class="kw">xlabel</span> <span class="kw">=</span> <span class="no">varName</span>, <span class="kw">title</span> <span class="kw">=</span> <span class="no">varName</span>,
                  <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend"</span>))
}</pre></body></html></div>
<p>These are not evaluated in this vignette. Note that all are in the same <code>linkingGroup</code>.</p>
<p>Other linked plots might exist as well – for example, a scatterplot of <code>gear</code> (the number of forward gears) versus <code>disp</code> (the engine displacement in cubic inches).</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">mtcars</span>, <span class="fu"><a href="../reference/l_plot.html">l_plot</a></span>(<span class="no">disp</span>, <span class="no">cyl</span>,
                         <span class="kw">xlabel</span> <span class="kw">=</span> <span class="st">"engine displacement"</span>, <span class="kw">ylabel</span> <span class="kw">=</span> <span class="st">"number of cylinders"</span>,
                         <span class="kw">title</span> <span class="kw">=</span> <span class="st">"1974 Motor Trend cars"</span>,
                         <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"Motor Trend"</span>,
                         <span class="kw">size</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">showScales</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                         <span class="kw">itemLabel</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">mtcars</span>), <span class="kw">showItemLabels</span> <span class="kw">=</span> <span class="fl">TRUE</span>
                         ))</pre></body></html></div>
<p>Note that each car’s name now appears as the <code>itemLabel</code> for that point in the plot (revealed as a “tooltip” style pop up), and that the plot <code>p</code> is in the same linking group as the histograms.</p>
<p>Through a combination of selection, inversion, deactivation, and reactivation, logical queries may be made interactively on the data.</p>
<p>For simplicity, the basic logical operators are illustrated below using only the histograms. More generally, these apply to any interactive <code>loon</code> graphic.</p>
</div>
<div id="interactive-logical-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#interactive-logical-operations" class="anchor"></a>Interactive logical operations</h2>
<p>Five logical conditions/operations illustrated here are the basic ones:</p>
<ol style="list-style-type: decimal">
<li>
<code>A</code> is <code>TRUE</code>
</li>
<li>Negation: (NOT <code>A</code>) is <code>TRUE</code>
</li>
<li>Inclusive OR: (<code>A</code> OR <code>B</code>) is <code>TRUE</code> (one or the other or both),</li>
<li>Conjunction: (<code>A</code> AND <code>B</code>) are both <code>TRUE</code>
</li>
<li>Exclusive OR: (<code>A</code> XOR <code>B</code>) meaning (<code>A</code> is <code>TRUE</code>) or (<code>B</code> is <code>TRUE</code>) but (<code>A</code> AND <code>B</code>) is FALSE</li>
</ol>
<p>Each of these corresponds to a sequence of actions on the plots and/or inspector. Whatever is highlighted in the end corresponds to the result.</p>
<p>Again, for simplicity all operations are illustrated by interacting with values of categorical variates in the various histograms. Any of the logical elements could also have been that satisfying numerical constraints by undertaking the corresponding actions on a scatterplot (or histogram of continuous values).</p>
<p>Each logical operator is illustrated in turn:</p>
<ol style="list-style-type: decimal">
<li>
<p><code>A</code> (<span class="math inline">\(= A\)</span>)</p>
<p><em>on the plot</em> select <code>A</code>,</p>
<ul>
<li><p>e.g., click on <code>"manual"</code> bar from the <code>Transmission</code> histogram</p></li>
<li><p>highlighted <span class="math inline">\(\iff\)</span> <code>Transmission == "manual"</code> is <code>TRUE</code></p></li>
</ul>
</li>
<li>
<p><strong>NOT</strong> <code>A</code> (<span class="math inline">\(= \overline{A}~~\)</span> or <span class="math inline">\(~~\neg A\)</span>)</p>
<p><em>on a plot</em> select <code>A</code>,</p>
<p><em>from the inspector</em> click <code>invert</code></p>
<ul>
<li>
<p>e.g., click on <code>"North America"</code> bar from the <code>continent</code> histogram,</p>
<p>then invert</p>
</li>
<li><p>highlighted <span class="math inline">\(\iff\)</span> <code>continent == "North America"</code> is <code>FALSE</code></p></li>
<li><p>all that is highlighted is <strong>not</strong> <code>"North America"</code>, namely <code>"Asia"</code> or <code>"Europe"</code></p></li>
</ul>
</li>
<li>
<p><code>A</code> <strong>OR</strong> <code>B</code> (<span class="math inline">\(= A \cup B~~\)</span> or <span class="math inline">\(~~A \lor B\)</span>),</p>
<p><em>on a plot</em> select <code>A</code>,</p>
<p><em>on the same (or a different but linked) plot</em> <code>&lt;SHIFT&gt;</code>- select <code>B</code></p>
<ul>
<li>
<p>e.g., click on <code>"manual"</code> bar from <code>Transmission</code> histogram,</p>
<p>then while holding down the <code>&lt;SHIFT&gt;</code> key,</p>
<p>click on the <code>Mercedes</code> bar in the <code>company</code> histogram</p>
</li>
<li><p>highlighted <span class="math inline">\(\iff\)</span> <code>Transmission == "manual"</code> is <code>TRUE</code> <strong>OR</strong> <code>company = "Mercedes"</code> is <code>TRUE</code> (or both)</p></li>
</ul>
</li>
<li>
<p><code>A</code> <strong>AND</strong> <code>B</code> (<span class="math inline">\(= A \cap B\)</span> or <span class="math inline">\(A \land B\)</span>)</p>
<p>lots of solutions, here is one that always works</p>
<p><em>on a plot</em> select <code>A</code>,</p>
<p><em>from the inspector</em>, <code>invert</code> then <code>deactivate</code> (only <code>A</code> remains),</p>
<p><em>from a plot of the remaining</em> select <code>B</code>,</p>
<p><em>from the inspector</em> <code>reactivate</code> all</p>
<ul>
<li><p>elements are highlighted <span class="math inline">\(\iff A \cap B\)</span></p></li>
<li><p>e.g. try highlighting all European cars with manual transmissions.</p></li>
</ul>
</li>
<li>
<p><code>A</code> <strong>XOR</strong> <code>B</code> (<span class="math inline">\(= (A \cup B) \cap (\overline{A \cap B})\)</span> or <span class="math inline">\((A \lor B) \land \neg({A \land B})\)</span>)</p>
<p><em>following steps in 4</em>, select <code>A</code> <strong>AND</strong> <code>B</code>,</p>
<p><em>from the inspector</em> <code>invert</code> then <code>deactivate</code> (only <span class="math inline">\(\neg({A \land B})\)</span> remains)</p>
<p><em>following steps in 3</em>, select <code>A</code> <strong>OR</strong> <code>B</code>,</p>
<p><em>from the inspector</em> <code>reactivate</code> (only <code>A</code> <strong>XOR</strong> <code>B</code> is highlighted)</p>
</li>
</ol>
<p>Other logical conditions (including numerical ones such as <code>disp &gt; 300</code> on the scatterplot <code>p</code>) are constructed as a combination of the above (as in exclusive or). These can be quite complex and it may help, after some number of steps, to mark intermediary results by colour (or also glyph in scatterplots).</p>
</div>
<div id="missing-data-and-linking-keys" class="section level2">
<h2 class="hasAnchor">
<a href="#missing-data-and-linking-keys" class="anchor"></a>Missing data and linking keys</h2>
<p>The <code>mtcars</code> data is an example of a complete data set. Had there been missing values, then these would not appear in loon plots that require them.</p>
<p>For example, suppose <code>data</code> has four variables <code>A</code>, <code>B</code>, <code>C</code>, and <code>D</code>, and</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">A</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">10</span>), <span class="fl">NA</span>), <span class="fl">10</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">FALSE</span>),
                   <span class="kw">B</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">10</span>), <span class="fl">NA</span>), <span class="fl">10</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">FALSE</span>),
                   <span class="kw">C</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"firebrick"</span>, <span class="st">"steelblue"</span>, <span class="fl">NA</span>), <span class="fl">10</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
                   <span class="kw">D</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>:<span class="fl">10</span>, <span class="fl">NA</span>), <span class="fl">10</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">FALSE</span>))
<span class="no">p_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/l_plot.html">l_plot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">A</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">B</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">C</span>, <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"test missing"</span>)
<span class="no">h_test</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/l_hist.html">l_hist</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">D</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">C</span>, <span class="kw">linkingGroup</span> <span class="kw">=</span> <span class="st">"test missing"</span>)</pre></body></html></div>
<p>Then</p>
<ul>
<li><p>wherever an <code>NA</code> appears in any of <code>A</code>, <code>B</code>, or <code>C</code>, that point will be missing from <code>p_test</code></p></li>
<li><p>wherever an <code>NA</code> appears in either of <code>C</code> or <code>D</code>, that point will be missing from <code>h_test</code></p></li>
</ul>
<p>Using logical operations on the original <code>data</code> to apply change plot properties (e.g. select values) can be challenging when data values are missing in the plot (since what is missing depends on what was missing at the time of its construction). For example,</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">p_test</span>[<span class="st">"selected"</span>] <span class="kw">&lt;-</span> (<span class="no">data</span>$<span class="no">A</span> <span class="kw">&gt;</span> <span class="fl">0</span>)</pre></body></html></div>
<p><strong>may not work</strong>! The logical operation on the data (<code>data$A &gt; 0</code>) will typically be longer than the corresponding x value <code>p_test["x"]</code> in the plot and so will not work.</p>
<p>Even if the logical vector is of the right length (and contains only <code>TRUE</code> or <code>FALSE</code>), the values may not be for the same data points.</p>
<p>There are four solutions when <code>data</code> contains <code>NA</code>s.</p>
<ul>
<li>
<p>The simplest is to constrain any logical queries to be on the plot itself, either</p>
<ul>
<li>interactively as described above or</li>
<li>programmatically as in <code>p_test["x"] &gt; 0</code> in place of <code>data$A &gt; 0</code>.</li>
</ul>
<p>This is straightforward and recommended for exploratory data analysis.</p>
<p>This works because all linking is done through the <code>linkingKey</code> of that plot, a character vector whose values uniquely identify each point in the plot (no duplicates).</p>
<p>Points appearing in different plots (in the same <code>linkingGroup</code>) are matched on the value of their <code>linkingKey</code>.</p>
<p>E.g., compare <code>p_test["linkingKey"]</code> and `h_test["linkingKey]".</p>
</li>
<li>
<p>Build plots using <strong>only complete data</strong>. That is, replace <code>data</code> by <code>c_data &lt;- na.omit(data)</code>.</p>
<p>Then any logic on <code>c_data</code> will match that on plots made from <code>c_data</code>.</p>
<p>Unfortunately, depending on the amount and pattern of missing data, this could critically reduce the amount of data in the analysis.</p>
</li>
<li>
<p>Construct all logical operations on the <code>data</code> <strong>before</strong> any plotting, adding variables as appropriate to <code>data</code> to capture the results.</p>
<p>This requires knowing what those logical queries are to be before looking at the data, the very antithesis to adaptive and interactive exploratory analysis.</p>
</li>
<li>
<p>Construct the plots and take care in mapping the logical outcomes on <code>data</code> to that subset of points peculiar to each plot.</p>
<p>To help manage this, the <code>linkingKey</code> of each plot can be used. Its default value for each plot is a character vector with entries inclusively between <code>"0"</code> and <code>"n-1"</code> where <code>n =</code>nrow(data)`.</p>
<p>The row numbers of <code>data</code> that correspong to the points in <code>p_test</code> are simply</p>
<p><code>1 + as.numeric(p_test["linkingKey"])</code></p>
<p>Similarly for <code>h_test</code>.</p>
<p>These indices can then be used to select the correct values resulting from any logical operation on <code>data</code>.</p>
<p><strong>Note</strong> however, that the user could provide their own special <code>linkingKey</code> for their plots.</p>
<ul>
<li>For example, <code>linkingKey = rownames(data)</code>.<br>
</li>
<li>If this is the case, a little greater care will be needed to translate these user defined linking keys into rows of <code>data</code> and hence the correct values of any logical operation on <code>data</code>.</li>
</ul>
</li>
</ul>
<p><strong>Of the four proposed solutions, the first and last are recommended when data are missing.</strong></p>
<p>Of course, if there is <strong>no</strong> missing data, there is no problem.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adrian Waddell, R. Wayne Oldford.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
