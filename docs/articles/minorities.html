<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analysis: Visible minorities in Canadian cities • loon</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analysis: Visible minorities in Canadian cities">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">loon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/introduction.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/minorities.html">Analysis example</a>
    </li>
    <li>
      <a href="../articles/teaching-example-smoothing.html">Teaching example</a>
    </li>
    <li>
      <a href="../articles/Rmarkdown.html">Using with Rmarkdown</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Videos
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://youtu.be/JFJcg855HcQ">the (not so) humble (interactive) histogram</a>
    </li>
    <li>
      <a href="https://youtu.be/mMJllGOuDLY">3D interactive scatterplots</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/great-northern-diver/loon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Analysis: Visible minorities in Canadian cities</h1>
                        <h4 class="author">R.W. Oldford</h4>
            
            <h4 class="date">2019-10-11</h4>
      
      
      <div class="hidden name"><code>minorities.Rmd</code></div>

    </div>

    
    
<div id="illustrates" class="section level3">
<h3 class="hasAnchor">
<a href="#illustrates" class="anchor"></a>Illustrates:</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(loon)</code></pre></div>
<ol style="list-style-type: decimal">
<li>linked histograms and scatterplots</li>
<li>interactive maps as scatterplots</li>
<li>plots with multiple layers including nested group layers</li>
<li>serial axes plots</li>
<li>serial axes glyphs</li>
</ol>
</div>
<div id="the-minority-data" class="section level1">
<h1 class="hasAnchor">
<a href="#the-minority-data" class="anchor"></a>The <code>minority</code> data</h1>
<p>Here we look at a brief exploratory analysis of some Statistics Canada data on the distribution of “visible minorities” within 33 Canadian cities. All descriptions of minorities are taken from Statistics Canada (though shortened here sometimes to aid the displays).</p>
<p>The data are part of the <code>loon</code> package and can be accessed through the <code><a href="https://rdrr.io/r/utils/data.html">data(...)</a></code> command.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(minority)</code></pre></div>
<p>The data are arranged as a <code>data.frame</code> of <code>nrow(minority) =</code> 33 Canadian cities with <code>ncol(minority) =</code> 18 measurements on each. The first 14 variates are Statistics Canada census numbers of people according to a declared <code>visible minority</code> together with the population of that <code>city</code>. The possibilities are</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority)[<span class="dv">1</span><span class="op">:</span><span class="dv">14</span>]</code></pre></div>
<pre><code>##  [1] "Arab"                                   
##  [2] "Black"                                  
##  [3] "Chinese"                                
##  [4] "Filipino"                               
##  [5] "Japanese"                               
##  [6] "Korean"                                 
##  [7] "Latin.American"                         
##  [8] "Multiple.visible.minority"              
##  [9] "South.Asian"                            
## [10] "Southeast.Asian"                        
## [11] "Total.population"                       
## [12] "Visible.minority.not.included.elsewhere"
## [13] "Visible.minority.population"            
## [14] "West.Asian"</code></pre>
<p>For example, here are the counts for three Canadian cities (3 rows of <code>minority</code>) from across Canada:</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">Victoria</th>
<th align="right">Ottawa-Gatineau</th>
<th align="right">St. John’s</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Arab</td>
<td align="right">500</td>
<td align="right">28195</td>
<td align="right">190</td>
</tr>
<tr class="even">
<td>Black</td>
<td align="right">2360</td>
<td align="right">45060</td>
<td align="right">620</td>
</tr>
<tr class="odd">
<td>Chinese</td>
<td align="right">12330</td>
<td align="right">32445</td>
<td align="right">990</td>
</tr>
<tr class="even">
<td>Filipino</td>
<td align="right">2760</td>
<td align="right">7330</td>
<td align="right">155</td>
</tr>
<tr class="odd">
<td>Japanese</td>
<td align="right">2280</td>
<td align="right">1800</td>
<td align="right">65</td>
</tr>
<tr class="even">
<td>Korean</td>
<td align="right">1235</td>
<td align="right">2280</td>
<td align="right">45</td>
</tr>
<tr class="odd">
<td>Latin.American</td>
<td align="right">1845</td>
<td align="right">10630</td>
<td align="right">320</td>
</tr>
<tr class="even">
<td>Multiple.visible.minority</td>
<td align="right">930</td>
<td align="right">4540</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td>South.Asian</td>
<td align="right">7210</td>
<td align="right">27130</td>
<td align="right">890</td>
</tr>
<tr class="even">
<td>Southeast.Asian</td>
<td align="right">1585</td>
<td align="right">11670</td>
<td align="right">55</td>
</tr>
<tr class="odd">
<td>Total.population</td>
<td align="right">325060</td>
<td align="right">1117120</td>
<td align="right">179270</td>
</tr>
<tr class="even">
<td>Visible.minority.not.included.elsewhere</td>
<td align="right">260</td>
<td align="right">1720</td>
<td align="right">40</td>
</tr>
<tr class="odd">
<td>Visible.minority.population</td>
<td align="right">33870</td>
<td align="right">179295</td>
<td align="right">3460</td>
</tr>
<tr class="even">
<td>West.Asian</td>
<td align="right">575</td>
<td align="right">6490</td>
<td align="right">65</td>
</tr>
</tbody>
</table>
<p>The remaining variates provide the geographic location of each city. The latitude and longitude of the cities were determined in two ways. First, the data in <code>canada.cities</code> from the <code>maps</code> package was used. This produced the <code>minority</code> variates <code>lat</code> and <code>long</code>. The second approach was to use the Google maps API to geocode the city names; the resulting coordinates are the variates <code>googleLat</code> and <code>googleLong</code>.</p>
<p>To see if they agree we plot them against one another.</p>
<p><img src="minorities_files/figure-html/unnamed-chunk-2-1.png" width="624" style="display: block; margin: auto;"></p>
<p>Note the disagreement over the location of the city of Quebec. A check against a map reveals</p>
<p><img src="minorities_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The Google values are wrong. It seems that the geocoded Google values picked up the <em>province</em> of Quebec and not to the <em>city</em> of Quebec! Something to be wary of when searching any database </p>
</div>
<div id="interactive-exploration-with-loon" class="section level1">
<h1 class="hasAnchor">
<a href="#interactive-exploration-with-loon" class="anchor"></a>Interactive exploration with <code>loon</code>
</h1>
<p>We now use the <code>loon</code> package to explore this data with some interactive tools.</p>
<p>We begin by looking at the distribution of population across these cities.</p>
<div id="populations" class="section level2">
<h2 class="hasAnchor">
<a href="#populations" class="anchor"></a>Populations</h2>
<p>We first look at the populations of the different cities:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> hTotPop &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span> (minority,   ## Using the "with" function
                              ## makes for easier reading
                  <span class="kw"><a href="../reference/l_hist.html">l_hist</a></span>(Total.population,
                         <span class="dt">title =</span> <span class="st">"33 Canadian cities"</span>
                          ) 
                  )
                  ## Save the histogram structure 
                  ## to work with later from the 
                  ## command line</code></pre></div>
<p>The distribution of the <code>Total.population</code> is skewed with a heavy right tail. Most Canadian cities have a relatively small population. A few cities, one in particular, has a relatively large population.</p>
<p>Note, that this histogram has very little in the way of annotation. This can be changed interactively by making various selections in the loon inspector. Try a few of these out and observe the results in the histogram. You may also make some selections in the histogram itself. Holding the shift key down while making a selection results in a “sticky” selection that allows multiple items to be selected.</p>
<p><strong>Exercise:</strong> Check the show <code>stacked colors</code> box in order to see the bar colours. Select the two histogram bars corresponding to the three most populous cities. Change the colour of these cities to some different colour selected from the <code>Modify</code> section. Select the <code>none</code> button to unhighlight the bars and reveal the modified colour.</p>
</div>
<div id="percentages" class="section level2">
<h2 class="hasAnchor">
<a href="#percentages" class="anchor"></a>Percentages</h2>
<p>Given that population totals vary so much, it might be more meaningful to look at each visible minority as its percentage of the city’s population.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  Reduce the minority data to percents of the total population</span>
<span class="co">#  in each city.</span>
<span class="co">#</span>

minorityPercent &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dv">100</span><span class="op">*</span>minority[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">12</span><span class="op">:</span><span class="dv">14</span>)]<span class="op">/</span>minority[,<span class="st">"Total.population"</span>])

<span class="co">#  Take the opportunity to shorten the Statistics Canada </span>
<span class="co">#  names of the minorities as well:</span>
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minorityPercent) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"% Arabic"</span>,  <span class="st">"% Black"</span>, <span class="st">"% Chinese"</span>,  
                            <span class="st">"% Filipino"</span>, <span class="st">"% Japanese"</span>,
                            <span class="st">"% Korean"</span>,  <span class="st">"% Latino"</span>, <span class="st">"% Multiple"</span>,
                            <span class="st">"% S. Asian"</span>,  <span class="st">"% SE Asian"</span>,  <span class="st">"% Other"</span>,
                            <span class="st">"% Minority"</span>, <span class="st">"% W Asian"</span>)</code></pre></div>
<p>We begin by looking at the total visibility minority percentage. Again a histogram is drawn, this time though many of its display values are specified at creation. Note that the <code>linkingGroup</code> is specified to be the string <code>"minority"</code>. This could have been any string – it merely identifies that this histogram will have its display linked with any other plot in the same <code>linkingGroup</code> .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The proportion of the city population that is a "visible minority"</span>
<span class="kw"><a href="../reference/l_hist.html">l_hist</a></span>(minorityPercent<span class="op">$</span><span class="st">"% Minority"</span>,
       <span class="dt">title =</span> <span class="st">"% Minority in 33 Canadian cities"</span>,
       <span class="dt">xlabel =</span> <span class="st">"percent of population"</span>,
       <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>,
       <span class="dt">yshows =</span> <span class="st">"frequency"</span>,
       <span class="dt">showBinHandle =</span> <span class="ot">FALSE</span>,
       <span class="dt">showGuides =</span> <span class="ot">TRUE</span>,
       <span class="dt">showScales =</span> <span class="ot">TRUE</span>
)</code></pre></div>
<p>As can be seen, the visible minority population most of these cities is less than 20% of its total population. But for two cities nearly half of the population is from some visible minority.</p>
<p>One might hypothesize that these two cities are the largest two. To test this we add the first histogram to the <code>linkingGroup</code> of the second. This can be done from the loon inspector for the total population histogram or programmatically from the command line as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/l_configure.html">l_configure</a></span>(hTotPop, <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>, <span class="dt">sync =</span> <span class="st">"push"</span>)</code></pre></div>
<p>In either case the displays must be synchronized (<code>sync</code>) within the group. Here we choose to <code>push</code> the linked elements of the total population histogram <code>hTotPop</code> out to the other members of the group. Checking the show <code>stacked colors</code> in both histograms will reveal their shared colours. Alternatively, use selection on each histogram.</p>
<p>As can be seen from the linked histograms, the two largest cities are not the two cities with the largest percentage of visible minorities. And conversely, the two cities having the largest visible minorities are not the two largest cities. However, selecting the largest of either will show through the linked displays that it is also the largest of the other. Less than 20% of the second largest city are visible minority.</p>
<div id="largest-visible-minorities" class="section level3">
<h3 class="hasAnchor">
<a href="#largest-visible-minorities" class="anchor"></a>Largest visible minorities</h3>
<p>It might be interesting to begin by looking at the percent visible minority in each city for the top three (say) visible minorities (in total):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now show the same for the three minority groups</span>
<span class="co"># having largest percentages (in decreasing order):</span>
groups &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minorityPercent)[<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">15</span>)]
largest3 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(minorityPercent[,groups ],
                             <span class="dv">2</span>, max),
                       <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)
                  )[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code></pre></div>
<p>and plot histograms of them</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># And now plot them</span>
<span class="cf">for</span> (x <span class="cf">in</span> largest3) {
  <span class="kw"><a href="../reference/l_hist.html">l_hist</a></span>(minorityPercent[,x],
         <span class="dt">title =</span> x,
         <span class="dt">xlabel=</span><span class="st">"percent of population"</span>,
         <span class="dt">linkingGroup=</span><span class="st">"minority"</span>,
         <span class="dt">showScales=</span><span class="ot">TRUE</span>,
         <span class="dt">showGuides=</span><span class="ot">TRUE</span>,
         <span class="dt">showStackedColors =</span><span class="ot">TRUE</span>
         )
}</code></pre></div>
<p>In decreasing order the largest three visible minorities <code>Chinese</code>, <code>South Asian</code>, and <code>Black</code>.</p>
<p>Looking at the <code>% Chinese</code> histogram one city has nearly 20% of its population being <code>Chinese</code>. It is the third largest city in the country.<br>
In contrast, the city with the greatest proportion of its population being <code>South Asian</code> (more than 15%) is one of the smallest of the 33 Canadian cities. Finally, the city having the largest percentage of <code>Black</code> inhabitants is the largest one.</p>
<p>Other relationships can be uncovered by selecting bars from different histograms. It’s worth exploring to better understand the data.</p>
<p>Better still is to link these histograms with the cities’ geographic locations on a map of Canada.</p>
</div>
</div>
<div id="interactive-maps" class="section level2">
<h2 class="hasAnchor">
<a href="#interactive-maps" class="anchor"></a>Interactive maps</h2>
<p>We again use the data from the <code>maps</code> package but now create an interactive map by using Loon’s facility for layering various geometric objects (including map polygons) on top of a scatterplot.</p>
<p>The map construction begins with a scatterplot of the cities located by their longitude and latitude. The coordinates of the polygons that make up the map of Canada (from the <code>maps</code> package) are <em>layered</em> on top of the scatterplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_map &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(minority,
              <span class="kw"><a href="../reference/l_plot.html">l_plot</a></span>(long, lat,
                     <span class="dt">xlabel =</span> <span class="st">"longitude"</span>, <span class="dt">ylabel =</span> <span class="st">"latitude"</span>,
                     <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>,
                     <span class="dt">itemLabel =</span> <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(minority),
                     <span class="dt">showLabels =</span> <span class="ot">TRUE</span>)
     )

<span class="co"># Add the map of Canada</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(maps)
landcol &lt;-<span class="st"> "cornsilk"</span>
canada &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map, 
                  <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"world"</span>, <span class="st">"Canada"</span>, 
                      <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>), 
                  <span class="dt">label =</span> <span class="st">"Canada"</span>,
                  <span class="dt">color =</span> landcol,
                  <span class="dt">index=</span><span class="st">"end"</span>)
<span class="co"># Rescale the plot to the size of the map</span>
<span class="kw"><a href="../reference/l_scaleto_layer.html">l_scaleto_layer</a></span>(p_map, canada)

<span class="co"># Could also add the text of the city names to the map</span>
<span class="co"># as glyphs</span>
<span class="kw"><a href="../reference/l_glyph_add_text.html">l_glyph_add_text</a></span>(p_map,
                 <span class="dt">text=</span><span class="kw"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span>(minority),
                 <span class="dt">label=</span><span class="st">"city names"</span>)</code></pre></div>
<p>The map is now ready to be used in analysis. It is part of the same linking group as the histograms so selecting bars in any histogram will highlight the corresponding cities on the map. These may be <strong>identified</strong> by holding the mouse over any point in the map (provided <code>glyphs: itemlabels</code> is checked).</p>
<p>Alternatively, the filled circle <code>glyph</code> for any city in the map can be replaced by the name of the city (since the last <code>R</code> statement above added these to the map). To <strong>change the glyph</strong>, first select the intended cities in the map then in the modification section at the bottom of the loon inspector select <code>city names</code> from the glyph menu (next to a <code>set</code> button). Clicking on the <code>set</code> button will change the glyph of all selected cities to a text string of their name. The glyph can be changed back by selecting the same points and then clicking on the filled circle glyph.</p>
<p>Note the map may be <strong>zoomed</strong> in on using scrolling and <strong>panned</strong> over directly on the map. Alternatively, the <strong>world view</strong> in the loon inspector may be used in the same way – dragging the scaled box around can be especially convenient. To get the map back to its original position and scale, click on the <code>scale to world</code> button in the <code>Plot</code> section of the loon inspector.</p>
<p>The map can be hidden (or removed). It is a <strong>layer</strong> of the scatterplot. Clicking on the <code>Layers</code> tab will provide access to this functionality. Clicking on the <code>Analysis</code> tab will return the inspector to the plot interactions typically used in an exploratory analysis.</p>
<p>While the above map is sufficient for the analysis it is sometimes of interest to have much more complex maps (or layers of any sort). In the next subsection a more detailed map (with lakes) is constructed using many layers. It provides an introduction to the layering facilities in loon. It can be skipped, or every <code>R</code> section can be evaluated in order to get a more sophisticated map.</p>
<p>The analysis can proceed with or without the next subsection.</p>
<div id="more-sophisticated-maps---multiple-layers" class="section level3">
<h3 class="hasAnchor">
<a href="#more-sophisticated-maps---multiple-layers" class="anchor"></a>More sophisticated maps - multiple layers</h3>
<p>Here we illustrate loon’s capacity for building and manipulating layers by adding the lakes to the map of Canada. While this is certainly unnecessary in the present analysis, it could be of value in other analyses (and produces nicer interactive maps).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lakecol &lt;-<span class="st"> "steelblue"</span>

<span class="co"># Get the coordinates from the lakes database in the maps package.</span>
<span class="co"># All lakes are recorded by name, so you will need to know which</span>
<span class="co"># are in Canada.  You either know the names, or you might have to</span>
<span class="co"># use trial and error, plotting the lakes and seeing which are inside</span>
<span class="co"># and which are outside the country.  If the database changes,</span>
<span class="co"># the indices below will need updating.</span>
<span class="co">#  </span>
<span class="co"># First, we'll deal with the Great Lakes:</span>
great.lakes &lt;-<span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                    <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                    <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">27</span>)]


<span class="co"># We can layer these directly</span>
great.lakes.layer &lt;-<span class="st">  </span><span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                              <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, great.lakes, 
                                  <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>), 
                              <span class="dt">label =</span> <span class="st">"Great Lakes Water"</span>,
                              <span class="dt">color =</span> lakecol,
                              <span class="dt">index=</span><span class="st">"end"</span>    <span class="co"># Add the layer at the end so we know</span>
                                             <span class="co"># where it is</span>
                              )

<span class="co"># Move the lake layer up to be above the land map</span>
<span class="kw"><a href="../reference/l_layer_raise.html">l_layer_raise</a></span>(p_map, great.lakes.layer)</code></pre></div>
<p>We can also add the islands back in. This is a good example of grouping different layers together into a single “group layer”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># </span>
<span class="co"># Great Lakes islands</span>
<span class="co">#</span>
<span class="co"># Unnamed islands are identified by a number added to the lake name</span>
<span class="co"># in which they appear</span>

uscolor &lt;-<span class="st"> "grey50"</span>
great.lakes.islands.US &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                              <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                              <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">9</span>, <span class="dv">29</span>,<span class="dv">31</span>, 
                                                 <span class="dv">45</span><span class="op">:</span><span class="dv">52</span>,<span class="dv">54</span>,
                                                 <span class="dv">55</span>, <span class="dv">59</span>,
                                                 <span class="dv">61</span><span class="op">:</span><span class="dv">63</span>)]

great.lakes.islands.CA &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                              <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                              <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>, <span class="dv">28</span>,<span class="dv">30</span>, 
                                                 <span class="dv">53</span>,<span class="dv">56</span><span class="op">:</span><span class="dv">58</span>,
                                                 <span class="dv">60</span>, <span class="dv">64</span><span class="op">:</span><span class="dv">66</span>)]


<span class="co"># Now for the islands</span>
great.lakes.islands.US.layer &lt;-<span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                                       <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                                           great.lakes.islands.US, 
                                           <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>), 
                                       <span class="dt">label =</span> <span class="st">"Great Lakes Islands (US)"</span>,
                                       <span class="dt">color=</span> uscolor,
                                       <span class="dt">index=</span><span class="st">"end"</span>
                                       )

great.lakes.islands.CA.layer &lt;-<span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                                       <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                                           great.lakes.islands.CA,
                                           <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>), 
                                       <span class="dt">label =</span> <span class="st">"Great Lakes Islands (CA)"</span>,
                                       <span class="dt">color =</span> landcol,
                                       <span class="dt">index=</span><span class="st">"end"</span>
                                       )

<span class="co"># We can put the two sets of islands into a group; first create the group</span>
great.lakes.islands.group &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer_group.html">l_layer_group</a></span>(p_map, 
                                          <span class="dt">label=</span><span class="st">"Great Lakes Islands"</span>, 
                                          <span class="dt">index=</span><span class="st">"end"</span>)
<span class="co"># Because it is immediately below the two sets of islands</span>
<span class="co"># (as seen in the "Layers" inspector)</span>
<span class="co"># we drop the islands into the group by demoting them</span>
<span class="kw"><a href="../reference/l_layer_demote.html">l_layer_demote</a></span>(p_map, great.lakes.islands.CA.layer)
<span class="kw"><a href="../reference/l_layer_demote.html">l_layer_demote</a></span>(p_map, great.lakes.islands.US.layer)

<span class="co"># Move the group layer up (twice now - once above the land, once above the lakes)</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>) <span class="kw"><a href="../reference/l_layer_raise.html">l_layer_raise</a></span>(p_map, great.lakes.islands.group)</code></pre></div>
<p>And we can nest groups as well. Here we put the Great Lakes and its islands together into a single group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#</span>
<span class="co"># Create a group layer for the great lakes</span>
<span class="co"># </span>
<span class="co"># First create the group layer</span>
great.lakes.group &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer_group.html">l_layer_group</a></span>(p_map, 
                                   <span class="dt">label=</span><span class="st">"Great Lakes"</span>, 
                                   <span class="dt">index=</span><span class="st">"end"</span>)

<span class="co"># Move the group up to be next to the great.lakes.layer</span>
<span class="kw"><a href="../reference/l_layer_raise.html">l_layer_raise</a></span>(p_map, great.lakes.group)

<span class="co"># Demoting the great.lakes.layer puts it inside the group</span>
<span class="kw"><a href="../reference/l_layer_demote.html">l_layer_demote</a></span>(p_map, great.lakes.layer)

<span class="co"># Now the islands are above the group and can be demoted</span>
<span class="co"># to become part of it.</span>
<span class="kw"><a href="../reference/l_layer_demote.html">l_layer_demote</a></span>(p_map, great.lakes.islands.group)</code></pre></div>
<p>For completion we add the remaining lakes and islands.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now the same for the boundary lakes.</span>
other.boundary.lakes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                            <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                            <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">33</span>,<span class="dv">80</span>)]

other.boundary.lakes.islands &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                                    <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                                    <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">81</span>)] 

<span class="co"># Because we know we are going to group these, we can create the group</span>
<span class="co"># first.</span>
<span class="co"># </span>
boundary.lakes.group &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer_group.html">l_layer_group</a></span>(p_map, 
                                      <span class="dt">label=</span><span class="st">"Boundary Lakes"</span>, 
                                      <span class="dt">index=</span><span class="st">"end"</span>)

<span class="co"># We now add the layers directly to that group using the "parent" </span>
<span class="co"># argument at creation time.</span>
<span class="co"># </span>
<span class="co"># Create the islands first this time.</span>
other.boundary.lakes.layer &lt;-<span class="st">  </span><span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                                       <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                                           other.boundary.lakes, 
                                           <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>),
                                       <span class="dt">label =</span> <span class="st">"Other Boundary Lakes Water"</span>,
                                       <span class="dt">color =</span> lakecol,
                                       <span class="dt">parent =</span> boundary.lakes.group,
                                       <span class="dt">index=</span><span class="st">"end"</span>
                                       )

other.boundary.lakes.islands.layer &lt;-<span class="st">  </span><span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                                               <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                                                   other.boundary.lakes.islands,
                                                   <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                                                   <span class="dt">fill=</span><span class="ot">TRUE</span>),
                                               <span class="dt">label =</span> <span class="st">"Other Boundary Lakes Islands"</span>,
                                               <span class="dt">color =</span> uscolor,
                                               <span class="dt">parent =</span> boundary.lakes.group,
                                               <span class="dt">index=</span><span class="st">"end"</span>
                                               )

<span class="co"># Move the group layer up</span>
<span class="kw"><a href="../reference/l_layer_raise.html">l_layer_raise</a></span>(p_map, boundary.lakes.group)</code></pre></div>
<p>And finally, all of the large interior lakes and their islands</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z

interior.lakes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                      <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                      <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">22</span>, <span class="dv">25</span>, 
                                         <span class="dv">68</span><span class="op">:</span><span class="dv">73</span>, 
                                         <span class="dv">82</span>, <span class="dv">85</span>)]

interior.lakes.islands &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                              <span class="dt">plot=</span><span class="ot">FALSE</span>, 
                              <span class="dt">fill=</span><span class="ot">TRUE</span>)<span class="op">$</span>names[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">23</span><span class="op">:</span><span class="dv">24</span>, 
                                                 <span class="dv">26</span>, <span class="dv">74</span>, 
                                                 <span class="dv">83</span><span class="op">:</span><span class="dv">84</span>)]
<span class="co"># First the group layer</span>
interior.lakes.group &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer_group.html">l_layer_group</a></span>(p_map, <span class="dt">label=</span><span class="st">"Interior Lakes"</span>, <span class="dt">index=</span><span class="st">"end"</span>)
<span class="co"># Create the interior islands first</span>
interior.lakes.islands.layer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                                        <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>,
                                            interior.lakes.islands,
                                            <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>),
                                        <span class="dt">label =</span> <span class="st">"Interior lakes islands"</span>,
                                        <span class="dt">color =</span> landcol,
                                        <span class="dt">parent =</span> interior.lakes.group,
                                        <span class="dt">index=</span><span class="st">"end"</span>
                                        )

interior.lakes.layer &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_layer.html">l_layer</a></span>(p_map,
                                <span class="kw"><a href="https://rdrr.io/pkg/maps/man/map.html">map</a></span>(<span class="st">"lakes"</span>, 
                                    interior.lakes, 
                                    <span class="dt">plot=</span><span class="ot">FALSE</span>, <span class="dt">fill=</span><span class="ot">TRUE</span>),
                                <span class="dt">label =</span> <span class="st">"Interior lakes"</span>,
                                <span class="dt">color =</span> lakecol,
                                <span class="dt">parent =</span> interior.lakes.group,
                                <span class="dt">index=</span><span class="st">"end"</span>
                                )

<span class="co"># And move the group layer up  </span>
<span class="kw"><a href="../reference/l_layer_raise.html">l_layer_raise</a></span>(p_map, interior.lakes.group)</code></pre></div>
<p>Now we have a more detailed map.</p>
</div>
</div>
<div id="minority-distributions-within-city" class="section level2">
<h2 class="hasAnchor">
<a href="#minority-distributions-within-city" class="anchor"></a>Minority distributions within city</h2>
<p>There are several different visible minorities in the data set. It might be of interest to look at how the cities differ from one another according to the relative differences in visible minority populations.</p>
<p>To facilitate the displays we will want to have short variate names for the visible minorities than those provided by Statistics Canada.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Back to the raw data and just rename variables</span>
minority_star &lt;-<span class="st"> </span>minority[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"Southeast.Asian"</span>, <span class="st">"Chinese"</span>, <span class="st">"Japanese"</span>, <span class="st">"South.Asian"</span>, 
    <span class="st">"Visible.minority.not.included.elsewhere"</span>,
     <span class="st">"Black"</span>, <span class="st">"Multiple.visible.minority"</span>, <span class="st">"Filipino"</span>,
    <span class="st">"Arab"</span>, <span class="st">"Korean"</span>, <span class="st">"Latin.American"</span>)]

<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
    <span class="st">"SE.Asian"</span>, <span class="st">"Chinese"</span>, <span class="st">"Japanese"</span>, <span class="st">"S.Asian"</span>, <span class="st">"Other"</span>,
    <span class="st">"Black"</span>, <span class="st">"Multiple"</span>, <span class="st">"Filipino"</span>, <span class="st">"Arab"</span>, <span class="st">"Korean"</span>, <span class="st">"Latino"</span>
)</code></pre></div>
<p>As the following few rows of this dataset show:</p>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">SE.Asian</th>
<th align="right">Chinese</th>
<th align="right">Japanese</th>
<th align="right">S.Asian</th>
<th align="right">Other</th>
<th align="right">Black</th>
<th align="right">Multiple</th>
<th align="right">Filipino</th>
<th align="right">Arab</th>
<th align="right">Korean</th>
<th align="right">Latino</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>St. John’s</td>
<td align="right">55</td>
<td align="right">990</td>
<td align="right">65</td>
<td align="right">890</td>
<td align="right">40</td>
<td align="right">620</td>
<td align="right">25</td>
<td align="right">155</td>
<td align="right">190</td>
<td align="right">45</td>
<td align="right">320</td>
</tr>
<tr class="even">
<td>Halifax</td>
<td align="right">655</td>
<td align="right">3100</td>
<td align="right">410</td>
<td align="right">2900</td>
<td align="right">180</td>
<td align="right">13270</td>
<td align="right">780</td>
<td align="right">530</td>
<td align="right">3840</td>
<td align="right">620</td>
<td align="right">690</td>
</tr>
<tr class="odd">
<td>Moncton</td>
<td align="right">65</td>
<td align="right">295</td>
<td align="right">10</td>
<td align="right">350</td>
<td align="right">10</td>
<td align="right">1035</td>
<td align="right">175</td>
<td align="right">100</td>
<td align="right">165</td>
<td align="right">65</td>
<td align="right">95</td>
</tr>
<tr class="even">
<td>Saint John</td>
<td align="right">60</td>
<td align="right">975</td>
<td align="right">10</td>
<td align="right">485</td>
<td align="right">30</td>
<td align="right">1250</td>
<td align="right">60</td>
<td align="right">205</td>
<td align="right">125</td>
<td align="right">120</td>
<td align="right">210</td>
</tr>
<tr class="odd">
<td>Saguenay</td>
<td align="right">55</td>
<td align="right">295</td>
<td align="right">0</td>
<td align="right">45</td>
<td align="right">10</td>
<td align="right">330</td>
<td align="right">10</td>
<td align="right">50</td>
<td align="right">195</td>
<td align="right">15</td>
<td align="right">280</td>
</tr>
<tr class="even">
<td>Quebec</td>
<td align="right">1615</td>
<td align="right">1855</td>
<td align="right">170</td>
<td align="right">535</td>
<td align="right">225</td>
<td align="right">5080</td>
<td align="right">235</td>
<td align="right">120</td>
<td align="right">2800</td>
<td align="right">165</td>
<td align="right">3150</td>
</tr>
</tbody>
</table>
<p>each city here has values for each of its 11 visible minority populations.</p>
<div id="pairs-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#pairs-plot" class="anchor"></a>Pairs plot</h3>
<p>It would be nice to be able to see all of these values at once to compare the cities. One possibility would be a scatterplot matrix such as that provided by the <code><a href="https://rdrr.io/r/graphics/pairs.html">pairs(...)</a></code> function in <code>R</code>.</p>
<p>In <code>loon</code> there is an analogous function <code><a href="../reference/l_pairs.html">l_pairs(...)</a></code> that produces an interactive scatterplot matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loon's scatterplot matrix</span>
<span class="co"># </span>
<span class="kw"><a href="../reference/l_pairs.html">l_pairs</a></span>(minority_star, <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>)</code></pre></div>
<p>Because we have created it with the same linking group, every scatterplot here is linked to every other display in the group. (Note that each plot here is a separate scatterplot and may be interacted with individually.)</p>
<p>While a scatterplot matrix shows all pairs of plots and so reveals some of the multidimensional structure of the data, it does not seem to be the most useful visual representation for the purposes here.</p>
<p>In a scatterplot matrix the focus is on the points (cities) within each pair of variates. The matrix arrangement and dynamic linking provides some means of connecting the cities across the variates.</p>
<p>In contrast, the focus we would like to have here is to compare the variate values within each city. To that end, the Cartesian coordinate system and matrix arrangement of a scatterplot matrix is not well-suited.</p>
</div>
<div id="serial-axes" class="section level3">
<h3 class="hasAnchor">
<a href="#serial-axes" class="anchor"></a>Serial axes</h3>
<p>Rather than arrange the axes in a Cartesian (orthogonal) system, serial axes arrange the axes side by side, either in parallel, or radially. This allows all of the axes (or a great many of them) to appear in the same plot. Each city, rather than appearing as a point now appears as a series of connected line segments, where each segment connects the values of a city on neighbouring axes. Serial axes in parallel are called parallel coordinate plots and are constructed with the <code><a href="../reference/l_serialaxes.html">l_serialaxes(...)</a></code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now construct the serial axes display so that </span>
<span class="co"># the cities are laid over top of one another.</span>
<span class="co"># </span>
s &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_serialaxes.html">l_serialaxes</a></span>(<span class="dt">data=</span>minority_star, 
                  <span class="dt">axesLayout=</span><span class="st">"parallel"</span>,
                  <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>,
                  <span class="dt">sequence=</span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star),
                  <span class="dt">showGuides=</span><span class="ot">FALSE</span>,
                  <span class="dt">linewidth=</span><span class="dv">5</span>,
                  <span class="dt">scaling =</span> <span class="st">"variable"</span>,
                  <span class="dt">showArea=</span><span class="ot">FALSE</span>,
                  <span class="dt">itemLabel=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(minority), 
                  <span class="dt">showItemLabels=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>This plot shows all variates at once for each city; each city is a <code>curve</code> of connected line segments. As with all other plots in <code>loon</code> the serial axes plot is interactive. Placing the mouse over any curve will reveal the city. Curves are selected by clicking on them or by sweeping (holding the mouse button down and moving it) a straight line over any number of curves.</p>
<p>In axis is scaled from 0 to 1. In this case, the scaling is done within each variable. That is, on each axis the city with the highest population for that visible minority is mapped to 1, the highest point on the axis; the city with the smallest population for that visible minority becomes 0, the lowest point on the axis.</p>
<p>For example the city with the highest Japanese population is Vancouver, the highest Arab population is Montreal, and the highest in all other visible minorities is Toronto (which is second highest in the other two).</p>
<p>For this data, a more interesting serial axes layout is the <code>radial</code> layout. Select this in the loon inspector or from the command line execute</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s[<span class="st">"axesLayout"</span>] &lt;-<span class="st"> "radial"</span></code></pre></div>
<p>Now the axes are arranged in the same order but radially with the zero at the centre and the maximum values at the radial axis extremes. Radial axes allow the curve to be closed which gives each city a distinctive shape according to its distribution of visible minorities. Toronto, for example, is clearly the largest (and nearly convex) shape. Montreal and Vancouver are also large and distinctive, as selecting them will reveal.</p>
<p>These shapes can be also be used as glyphs in a scatterplot which allows them to be visually separated. For example, we can use the features of a scatterplot to place these figures in roughly east to west order using <code>long</code>.<br>
First create a new scatterplot, then add serial axes as alternative glyphs for the points. To emphasize shape the glyphs are drawn filled in with <code>showArea=TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Produce grid of star glyphs</span>
p_stars &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(minority,
                <span class="kw"><a href="../reference/l_plot.html">l_plot</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rank.html">rank</a></span>(long), <span class="kw"><a href="https://rdrr.io/r/base/rank.html">rank</a></span>(long),
                       <span class="dt">title =</span> <span class="st">""</span>, 
                       <span class="dt">showScales =</span> <span class="ot">FALSE</span>, 
                       <span class="dt">xlabel =</span> <span class="st">""</span>,
                       <span class="dt">ylabel =</span> <span class="st">""</span>,
                       <span class="dt">showLabels=</span><span class="ot">FALSE</span>, <span class="dt">size=</span><span class="dv">3</span>,
                       <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>,
                       <span class="dt">itemLabel=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(minority), 
                       <span class="dt">showItemLabels=</span><span class="ot">TRUE</span>))

gstars &lt;-<span class="kw"><a href="../reference/l_glyph_add_serialaxes.html">l_glyph_add_serialaxes</a></span>(p_stars,
                                <span class="dt">axesLayout =</span> <span class="st">"radial"</span>,
                                <span class="dt">data=</span>minority_star,
                                <span class="dt">sequence =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star),
                                <span class="dt">scaling =</span> <span class="st">"variable"</span>,
                                <span class="dt">showArea=</span><span class="ot">TRUE</span>)
p_stars[<span class="st">"glyph"</span>] &lt;-<span class="st"> </span>gstars</code></pre></div>
<p>Clearly, Toronto dominates in size, followed by Vancouver at the far left, and Montreal to the near right.</p>
<p>The points could also be moved (temporarily) to a grid.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># </span>
<span class="kw"><a href="../reference/l_move_grid.html">l_move_grid</a></span>(p_stars, <span class="dt">which=</span><span class="st">"all"</span>)
<span class="co"># swapAxes neccessary to arrange west-east in the grid (columns)</span>
p_stars[<span class="st">"swapAxes"</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
<span class="kw"><a href="../reference/l_zoom.html">l_zoom</a></span>(p_stars, .<span class="dv">9</span>)
<span class="co">#</span></code></pre></div>
<p>Optionally we could choose to add a continuous color change emphasizing the west to east directionality. There is a <code>col_numeric</code> function in the <code>scales</code> package that will effect a continuous change in color along a spectrum.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(scales)
west_east_cols &lt;-<span class="st"> </span>(<span class="kw"><a href="https://rdrr.io/pkg/scales/man/col_numeric.html">col_numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"firebrick"</span>, 
                                 <span class="st">"orange"</span>, <span class="st">"sienna"</span>,
                                 <span class="st">"darkgreen"</span>, <span class="st">"steelblue"</span>,
                                 <span class="st">"purple"</span>),
                               <span class="dt">domain =</span> <span class="ot">NULL</span>)
                   )(minority<span class="op">$</span>long)

<span class="co"># Just need to color the glyphs on one of the plots</span>
<span class="co"># since they are all linked.</span>
s[<span class="st">"color"</span>] &lt;-<span class="st"> </span>west_east_cols</code></pre></div>
<p>Adding the glyphs to the map gives a precise geographic location for each city.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add some glyphs to the map,</span>
<span class="co"># scale values within variates</span>
so &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_glyph_add_serialaxes.html">l_glyph_add_serialaxes</a></span>(p_map, <span class="dt">data=</span>minority_star,
                             <span class="dt">sequence =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star),
                             <span class="dt">scaling =</span> <span class="st">"variable"</span>,
                             <span class="dt">showArea=</span><span class="ot">TRUE</span>,
                             <span class="dt">label=</span><span class="st">"stars"</span>)
p_map[<span class="st">"glyph"</span>] &lt;-<span class="st"> </span>so</code></pre></div>
<p>Unfortunately the three large cities dominate in each of these displays. All other cities are so tiny that the shape is difficult to discern. This is due to scaling within each variate.</p>
<p>A better choice would be to scale each city by its largest visible minority population. That way the differences in population size between cities will not dominate. Instead, the differences in visible minority populations within cities will be emphasized. Those cities, however large or small, which have a similarly shaped glyph will have a similar distribution within its visible minority populations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s[<span class="st">"scaling"</span>] &lt;-<span class="st"> "observation"</span>
gstars[<span class="st">"scaling"</span>] &lt;-<span class="st"> "observation"</span>
so[<span class="st">"scaling"</span>] &lt;-<span class="st"> "observation"</span>

<span class="co"># Double the size of the glyphs on the map.</span>
p_map[<span class="st">"size"</span>] &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>p_map[<span class="st">"size"</span>] </code></pre></div>
<p>Looking over the map a number of interesting observations can be made. For example, regional similarities are easily seen. From the west, Victoria and Vancouver have a very similar visible minority distribution with a large Chinese percentage and then South Asian.</p>
<p>The other two cities in British Columbia are strikingly different. The visible minority population in Abbotsford-Mission is almost entirely South Asian; the other visible minorities are nearly zero by comparison. The glyph for Kelowna shows an unusually high proportion of Japanese in comparison to the other three cities to its west.</p>
<p>Moving into the provinces of Alberta and Saskatchewan (the next four glyphs moving east) we see a great similarity in the glyph shape of the four cities of Calgary, Edmonton, Saskatoon, and Regina. The next one to the right (east) is Winnipeg, having a shape which would match that of the previous four were it not for Winnipeg’s relatively large Filipino population. The proboscis of Winnipeg’s mosquito shaped glyph draws attention to its unusually large Filipino population.</p>
<p>Note that this analysis is easily done using only three loon windows showing simultaneously. The first is the serial axes plot, which makes it easy to read off the contributions of each visible minority whenever any glyph is selected elsewhere. The second is the map of Canada, preferably zoomed in to magnify a small rectangular region. Placing the mouse over any glyph reveals the city. And third, the loon inspector. This is particularly handy if it is focused on the map for then the small rectangle in its <code>World View</code> may be dragged across the country to focus the Canada map on any small region.</p>
<p>Continuing west to east, at the western head of Lake Superior (western most Great Lake) the province of Ontario begins and the glyph for Thunder Bay shows it to have an unusually large (relative) population of Japanese compared to other cities.</p>
<p>As we move southeast into southern Ontario, some new glyph shapes and hence visible minority patterns emerge. For example, most southern Ontario cities are characterized by relatively high South Asian populations. Compared to the prairie provinces of Alberta, Saskatchewan, and Manitoba, Ontario cities (and cities east of Ontario) have a relatively large black minority. In southern Ontario, Windsor and London have an unusual large Arab population compared to their neighbours. London and St. Catharines have unusually large Latino populations. As with western cities, most Ontario cities have relatively large Chinese populations.</p>
<p>This could be contrasted with cities in Quebec, for example, which have relatively low South Asian and Chinese populations. Saguenay is unusual in Quebec in having a relatively large Chines population. Instead, the unusually large populations in Quebec cities are the relatively large Arab and Latino populations.</p>
<p>The maritime provinces of New Brunswick and Nova Scotia are unusual in having much larger black populations than other visible minorities though Saint John also has a relatively large Chines population. Moncton and Halifax look more alike. St. John’s in Newfoundland resembles the Toronto in its configuration of visible minorities.</p>
</div>
<div id="manually-moving-points" class="section level3">
<h3 class="hasAnchor">
<a href="#manually-moving-points" class="anchor"></a>Manually moving points</h3>
<p>An interesting exercise would be to move those glyphs which most resemble each other closer together. This is best effected in the plot without the map where we had already placed the glyphs on a grid.</p>
<p>First make sure we put them on a grid to start:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/l_move_grid.html">l_move_grid</a></span>(p_stars, <span class="dt">which=</span><span class="st">"all"</span>)</code></pre></div>
<p>Now any single point can be moved through direct manipulation by selecting it and, while holding both the mouse button and control (ctrl) keys down, dragging it to be near a similarly shaped glyph. Many points can be selected at once moved by additionally holding the shift key down. In loon the shift key always indicates multiple items. In this way we can visually cluster the cities according to glyph shape.</p>
<p><strong>Exercise:</strong> Try it. Visually cluster the glyphs. Which cities are most alike? Do the clusters correspond to spatial map regions? Can the glyphs be ordered in some way? Does this match any spatial map ordering?</p>
</div>
<div id="ordering-the-axes" class="section level3">
<h3 class="hasAnchor">
<a href="#ordering-the-axes" class="anchor"></a>Ordering the axes</h3>
<p>Since our perception of which glyphs look most alike might depend on which variates appear beside each other, it is often a good idea to consider more than one ordering of the glyph axes. This attention to pairwise ordering is the raison d’etre of the pairwise visualization package <code>PairViz</code>. It offers a number of ways to construct a pairwise ordering. We consider a few of them here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Axis ordering methods can be found</span>
<span class="co"># in the pairwise coordinate visualization package</span>
<span class="co"># called PairViz</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PairViz)</code></pre></div>
<p>Perhaps the first thing to consider would be some measure of each pair of visible minorities. For example, suppose we consider the values for each visible minority proportion over all <span class="math inline">\(33\)</span> cities as a single <span class="math inline">\(33\)</span>-dimensional vector. The distance between these vectors will give a measure of how alike the relative population of visible minorities are across all <span class="math inline">\(33\)</span> cities.</p>
<p>We can calculate the matrix of distances as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First transform minority_star to within city percentages.</span>
minority_star_percent &lt;-<span class="st"> </span><span class="dv">100</span><span class="op">*</span>minority_star<span class="op">/</span>minority[,<span class="st">"Total.population"</span>]

<span class="co"># Each variate is now treated as a position in the</span>
<span class="co"># space of the cities.  We calculate the distances</span>
<span class="co"># between the variates.</span>
<span class="co"># </span>
VarDistance &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(minority_star_percent))</code></pre></div>
<p>Now these distances can be used to try to find a possibly better ordering of the minorities in a serial axes plot. We will use a solution to a travelling salesman problem (with unintended irony) to order the visible minorities by finding the shortest (or longest) distances between the minorities (and not the cities).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We will use these distances in a travelling</span>
<span class="co"># salesman problem that chooses an order to have</span>
<span class="co"># minimal distances. </span>
<span class="co"># The appropriate function from PairViz is order_tsp(...)</span>
<span class="co"># </span>
<span class="co"># Placing minorities that are close to each other</span>
<span class="co"># (in the above distance) beside each other should</span>
<span class="co"># result in somewhat more convex shaped glyphs.</span>
<span class="co"># </span>
o_near &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/PairViz/man/order_tsp.html">order_tsp</a></span>(VarDistance)
<span class="co"># The order of minorities:</span>
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star_percent)[o_near]</code></pre></div>
<pre><code>##  [1] "Filipino" "Korean"   "Japanese" "Multiple" "Other"    "SE.Asian"
##  [7] "Latino"   "Arab"     "Black"    "Chinese"  "S.Asian"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Alternatively, placing distant variates beside each</span>
<span class="co"># other should produce less convex shaped glyphs.</span>
<span class="co"># </span>
o_far &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/PairViz/man/order_tsp.html">order_tsp</a></span>(<span class="op">-</span>VarDistance)
<span class="co"># The order of minorities:</span>
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star_percent)[o_far]</code></pre></div>
<pre><code>##  [1] "Latino"   "Chinese"  "Multiple" "S.Asian"  "Other"    "Filipino"
##  [7] "SE.Asian" "Black"    "Japanese" "Arab"     "Korean"</code></pre>
<p>We will try both of these orderings and add them to existing plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Now construct the serial axes display so that </span>
<span class="co"># the cities are laid over top of one another.</span>
<span class="co"># </span>
s_close &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_serialaxes.html">l_serialaxes</a></span>(<span class="dt">data=</span>minority_star, 
                        <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>,
                        <span class="dt">sequence=</span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star)[o_near],
                        <span class="dt">showGuides=</span><span class="ot">FALSE</span>,
                        <span class="dt">linewidth=</span><span class="dv">5</span>,
                        <span class="dt">scaling =</span> <span class="st">"observation"</span>,
                        <span class="dt">showArea=</span><span class="ot">FALSE</span>,
                        <span class="dt">title=</span><span class="st">"Nearest minority order"</span>,
                        <span class="dt">itemLabel=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(minority), 
                        <span class="dt">showItemLabels=</span><span class="ot">TRUE</span>)

s_far &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_serialaxes.html">l_serialaxes</a></span>(<span class="dt">data=</span>minority_star, 
                      <span class="dt">linkingGroup =</span> <span class="st">"minority"</span>,
                      <span class="dt">sequence=</span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star)[o_far],
                      <span class="dt">showGuides=</span><span class="ot">FALSE</span>,
                      <span class="dt">linewidth=</span><span class="dv">5</span>,
                      <span class="dt">scaling =</span> <span class="st">"observation"</span>,
                      <span class="dt">showArea=</span><span class="ot">FALSE</span>,
                      <span class="dt">title=</span><span class="st">"Farthest minority order"</span>,
                      <span class="dt">itemLabel=</span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(minority), 
                      <span class="dt">showItemLabels=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>Add the glyphs to the grid plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gstars_near &lt;-<span class="kw"><a href="../reference/l_glyph_add_serialaxes.html">l_glyph_add_serialaxes</a></span>(p_stars,
                                <span class="dt">data=</span>minority_star,
                                <span class="dt">sequence =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star)[o_near],
                                <span class="dt">scaling =</span> <span class="st">"observation"</span>,
                                <span class="dt">label =</span> <span class="st">"Nearest"</span>,
                                <span class="dt">showArea=</span><span class="ot">TRUE</span>)
p_stars[<span class="st">"glyph"</span>] &lt;-<span class="st"> </span>gstars_near

gstars_far &lt;-<span class="kw"><a href="../reference/l_glyph_add_serialaxes.html">l_glyph_add_serialaxes</a></span>(p_stars,
                                <span class="dt">data=</span>minority_star,
                                <span class="dt">sequence =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star)[o_far],
                                <span class="dt">scaling =</span> <span class="st">"observation"</span>,
                                <span class="dt">label =</span> <span class="st">"Farthest"</span>,
                                <span class="dt">showArea=</span><span class="ot">TRUE</span>)
p_stars[<span class="st">"glyph"</span>] &lt;-<span class="st"> </span>gstars_far</code></pre></div>
<p>And now on the map:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add  glyphs to the map</span>
so_near &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_glyph_add_serialaxes.html">l_glyph_add_serialaxes</a></span>(p_map, <span class="dt">data=</span>minority_star,
                                  <span class="dt">sequence =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star)[o_near],
                                  <span class="dt">scaling =</span> <span class="st">"observation"</span>,
                                  <span class="dt">showArea=</span><span class="ot">TRUE</span>,
                                  <span class="dt">label=</span><span class="st">"Nearest"</span>)
p_map[<span class="st">"glyph"</span>] &lt;-<span class="st"> </span>so_near

so_far &lt;-<span class="st"> </span><span class="kw"><a href="../reference/l_glyph_add_serialaxes.html">l_glyph_add_serialaxes</a></span>(p_map, <span class="dt">data=</span>minority_star,
                                 <span class="dt">sequence =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(minority_star)[o_far],
                                 <span class="dt">scaling =</span> <span class="st">"observation"</span>,
                                 <span class="dt">showArea=</span><span class="ot">TRUE</span>,
                                 <span class="dt">label=</span><span class="st">"Farthest"</span>)
p_map[<span class="st">"glyph"</span>] &lt;-<span class="st"> </span>so_near</code></pre></div>
<p><strong>Exercise:</strong> Try switching to any of these alternatives and see whether your clustering choices change. Which is easier? Convex or non-convex?</p>
<p>The <code>PairViz</code> package also offers a couple of means of ensuring all variates appear as a pair. This is usually more helpful for serial axes that are parallel than radial. These include the following</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">o_greedy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/PairViz/man/eulerian.html">eulerian</a></span>(VarDistance)
o_balanced &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/PairViz/man/whpaths.html">weighted_hpaths</a></span>(VarDistance, <span class="dt">matrix=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><strong>Exercise:</strong> Try these and determine the difference between them.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#the-minority-data">The <code>minority</code> data</a></li>
      <li>
<a href="#interactive-exploration-with-loon">Interactive exploration with <code>loon</code></a><ul class="nav nav-pills nav-stacked">
<li><a href="#populations">Populations</a></li>
      <li><a href="#percentages">Percentages</a></li>
      <li><a href="#interactive-maps">Interactive maps</a></li>
      <li><a href="#minority-distributions-within-city">Minority distributions within city</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adrian Waddell, R. Wayne Oldford.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
